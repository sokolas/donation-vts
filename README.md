# Скачать
Архив с последней версией: https://github.com/sokolas/donation-vts/releases/download/v1.0.6/donation-vts.zip

# Использование

**English manual**: https://github.com/sokolas/donation-vts/blob/master/README-EN.md

В первую очередь надо включить плагины в vtube studio: [см. тут](https://github.com/DenchiSoft/VTubeStudio/wiki/Plugins#how-to-use-plugins)
У плагина нет установщика, нужно скачать архив и распаковать, для запуска использовать `donations-vts.exe`. Если все сделано правильно, то посла запуска появится черное окно с логами программы, через несколько секунд откроется браузер с настройками, а в vtube studio через несколько секунд появится окно с подтверждением плагина; это нужно один раз, разрешите его.
После того, как плагин добавлен, статус Vtube Studio станет `READY`, а в vtube studio появится новый параметр (по умолчанию называется DonationPluginParam).
Дальше нужно настроить соответствие параметра плагина какому-то параметру модели, который должен меняться от донатов. Подробно это описано [вот тут (англ)](https://github.com/DenchiSoft/VTubeStudio/wiki/Plugins#what-are-custom-parameters)

После этого необходимо зарегистрировать этот плагин в donationalerts. **регистрация возможна только при запущенном приложении** одним из способов:
* Нажмите на ссылку `GRANT`
* Откройте ярлык `Authorize Donationalerts`, который лежит в папке рядом с программой
* Перейдите [по этой ссылке](https://www.donationalerts.com/oauth/authorize?client_id=10695&redirect_uri=http%3A%2F%2Flocalhost%3A9696%2F&response_type=token&scope=oauth-donation-subscribe+oauth-user-show)
Во всех этих случаях должен открыться сайт Donationalerts, там необходимо разрешить приложению доступ. Если все прошло успешно, появится надпись "Success!" в браузере, вкладку можно закрыть. Это нужно сделать один раз при первом запуске, и обычно повторной регистрации приложения не требуется.
Если все прошло успешно, статус donationalerts станет `READY`.

Для проверки подключения донатов перейдите [по ссылке](https://www.donationalerts.com/dashboard/activity-feed/donations) и нажмите кнопку "добавить донат"/"add donation"; введите сумму и поставьте галочку "показывать в виджете"/"alert donation in widget"; подтвердите. Если все правильно, в логе программы появится сообщение " Received donation from Donations/...".

Программа настраивается через браузер или редактирование настроек в `config.json` в блокноте. При изменении настроек через конфиг нужно закрыть программу и запустить ее снова. Vtube studio перезапускать не надо.
Если по какой-то причине настройки из браузера не применились, закройте программу и откройте снова. Интерфейс настройки в браузере перезапускать не надо, настройки из плагина обновятся сами через несколько секунд.

**Настройки параметра для vtube studio**
*	`Parameter name` (`"customParam"` в конфиге): `"DonationPluginParam"` - название параметра, который будет меняться от донатов. К нему будет привязан параметр модели.
*	`Description` (`"paramDescription"` в конфиге): `"donation alerts custom param"` - описание параметра, ни на что не влияет, кроме текста в vtube studio. Если у вас много плагинов, может быть полезно.
*	`Stay time` (`"stayTime"` в конфиге): `20` (целое число) - каждый раз, когда приходит донат и параметр устанавливается в новое значение, он держится **заданное время**, а потом начинает уменьшаться обратно до 0. Чтобы он не уменьшался автоматически, поставьте значение `-1`
*	`Decay time` (`"decayTime"` в конфиге): `5` (целое число) - за это время (в секундах) параметр уменьшится обратно до 0. Подробное описание с примером см. ниже
*   `Multiplier` (`"multiplier"` в конфиге): `1` (целое/дробное число) - когда приходит донат, его сумма в стандартной валюте пользователя будет умножаться на это число, чтобы добавить/установить параметр. См. пример ниже
*	`Add param value` (`"addParam"` в конфиге): `true`/`false` - если включено(`true`), то донаты будут **добавлять** значение к параметру, если выключено(`false`), то будут **заменять**

**Other**
* `Reset tokens` - сбрасывает все разрешения для vtube studio и donationalerts, используйте, если возникли проблемы с доступом.
* `Show UI on startup` (`"autoOpenUi"` в конфиге): `true`/`false` - открывать интерфейс в браузере автоматически при запуске плагина. **если вкладка с настройками уже открыта, новая автоматически открываться не будет**

* `Save` - применить настройки и сохранить конфиг. Если вдруг они не применились, перезапустите плагин. Вкладку с настрйками перезапускать не надо.
* `Reload` - отменить все несохраненные изменения и вернуть настройки, которые сейчас в плагине.

Остальные настройки (**меняйте, только если что-то не работает, или вы знаете, что именно вам надо**)
*	`Log messages` (`"logVtsMessages"` для vtube studio, `"logDaMessages"` для донатов в конфиге): `true`/`false` - писать все сообщения, которые приходят. Это может быть нужно, если что-то не работает.
*	`Address` (`"vtsAddr"` в конфиге): `"ws://localhost:8001"` - адрес vtube studio. Если вы не меняли порт в настройках плагинов, то оставьте, как есть. [Подробнее про плагины (англ)](https://github.com/DenchiSoft/VTubeStudio/wiki/Plugins#how-to-use-plugins)
*	`"vtsToken"`: `""` - токен доступа к vtube studio. Программа получает его и сохраняет автомматически при разрешении плагина в студии. Если возникли какие-то проблемы и плагин не работает, попробуйте нажать `Reset tokens` и перезапустить программу.
*	`"daToken"`: `""` - токен доступа к donationalerts. **никому не сообщайте его!** Программа получает его и сохраняет автомматически при разрешении доступа к donationalerts. Если с получением донатов какие-то проблемы, замените его на пустую строку `""` и перезапустите программу. При этом нужно снова перейти по ссылке (ярлык `Authorize Donationalerts`) и авторизовать приложение заново.
*   `"daPort"`": `9696` - порт для регистрации в donationalerts. **он указан в настройках donationalerts и с другим портом регистрация работать не будет**. Если у вас пок акой-то причине этот порт занят и регистрация не работает, то придется [создать свое приложение](https://www.donationalerts.com/application/clients) на donationalerts и использовать его порт и AppID
*   `"daAppId"`: `"10695"` - AppID для регистрации на donationalert. **меняйте его, только если вы зарегистрировали там свое собственное приложение и поменяли порт/redirect и знаете, что делаете**

# Пример
Допустим, вы не меняли конфиг, и по умолчанию стоят значения: `stayTime: 20`, `decayTime: 5`, `addParam: true` и `multiplier: 1` и параметр привязан, допустим, к размеру головы. По умолчанию значение параметра 0 и голова модели нормального размера.
* приходит донат в 1 USD. Допустим, валюта аккаунта - рубли и курс, например, 80р за USD. Вы получите `1*80=80`р. Это число умножается на `multiplier` (1), получается 80, и параметр устанавливается в 80.
* Через 20 секунд (stayTime) параметр начинает уменьшаться. Он уменьшится обратно до 0 за 5 сек (decayTime).
* Если за это время (25 сек) придет второй донат, например, еще на 0.5 USD, он снова пересчитается в число для параметра(уже в 40) и это число **добавится** к тому, что уже установлено (потому что `addParam: true`) и будет держаться еще 20 сек, пока не начнет "сдуваться". Если параметр будет больше 100, то вместо этого он установится ровно в 100.
